let products1 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-baby-mix-hong-kem.jpg.webp",
    name: "Endless Love",
    sale: 11,
    newPrice: "390000VND",
    oldPrice: "440000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-hong-dieu-ngot-ngao-nhat.jpg.webp",
    name: "Điều Hạnh Phúc",
    sale: 18,
    newPrice: "860000VND",
    oldPrice: "1,050000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/APR_2024/hi-vong-nang-mai-1.jpg.webp",
    name: "Ineffable",
    sale: 12,
    newPrice: "370000VND",
    oldPrice: "420000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-hong-do-burning-love.jpg.webp",
    name: "Burning Love",
    sale: 11,
    newPrice: "590000VND",
    oldPrice: "660000VND",
  },
];

let products2 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-cuc-tana-little-tana.jpg.webp",
    name: "Little Tana",
    sale: 0,
    newPrice: "390000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/APR_2024/z5518904182385_fe64a4bf55c1dacca1aed16614cdceb4.jpg.webp",
    name: "Your Day",
    sale: 0,
    newPrice: "470000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/bo-hoa-baby-hong-pink-moon.jpg.webp",
    name: "Pink Moon",
    sale: 9,
    newPrice: "940000VND",
    oldPrice: "1030000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/khuc-tinh-ca.jpg.webp",
    name: "Khúc Tình Ca",
    sale: 6,
    newPrice: "580000VND",
    oldPrice: "620000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/bo-hoa-cat-tuong-nu-cuoi-em.jpg.webp",
    name: "Nụ Cười Em",
    sale: 7,
    newPrice: "390000VND",
    oldPrice: "420000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/bo-hoa-baby-first-date.jpg.webp",
    name: "First Date",
    sale: 12,
    newPrice: "520000VND",
    oldPrice: "590000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/nha-nhan.jpg.webp",
    name: "Nhã Nhặn",
    sale: 0,
    newPrice: "490000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_048.jpg.webp",
    name: "Just Love",
    sale: 20,
    newPrice: "240000VND",
    oldPrice: "300000VND",
  },
];

let products3 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_046.jpg.webp",
    name: "Lời Yêu Đầu",
    sale: 0,
    newPrice: "3570000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_045.jpg.webp",
    name: "Đại Dương Xanh",
    sale: 0,
    newPrice: "1125000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_059.jpg.webp",
    name: "Thu Dịu Dàng",
    sale: 0,
    newPrice: "650000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_055.jpg.webp",
    name: "Mưa Thu",
    sale: 0,
    newPrice: "480000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_057.jpg.webp",
    name: "Êm Đềm Thương",
    sale: 0,
    newPrice: "880000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_049.jpg.webp",
    name: "Charming Rune",
    sale: 0,
    newPrice: "1875000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/Autumn_2024/NEWBOUQUET_050.jpg.webp",
    name: "Dreamlike",
    sale: 0,
    newPrice: "1350000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/APR_2024/hoaxanh.jpg.webp",
    name: "Magnificent",
    sale: 0,
    newPrice: "3300000VND",
    oldPrice: "",
  },
];

let products4 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/gio-hoa-may-man.jpg.webp",
    name: "May Mắn",
    sale: 0,
    newPrice: "580000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/lang-hoa-hong-ban-tinh-ca.jpg.webp",
    name: "Bản Tình Ca",
    sale: 0,
    newPrice: "550000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-hong-do-only-love.jpg.webp",
    name: "Only Love",
    sale: 9,
    newPrice: "390000VND",
    oldPrice: "430000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/bo-hoa-dong-tien-eap.jpg.webp",
    name: "E Ấp",
    sale: 14,
    newPrice: "360000VND",
    oldPrice: "420000VND",
  },
];

let products5 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/hoa-khai-truong-nhiet-huyet.jpg.webp",
    name: "Kệ Hoa Khai Trương Nhiệt Huyết",
    sale: 0,
    newPrice: "880000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/hoa-khai-truong-cat-tuong.jpg.webp",
    name: "Hoa Khai Trương Cát Tường",
    sale: 0,
    newPrice: "910000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/hoa-khai-truong-hong-phat-2.jpg.webp",
    name: "Kệ Hoa Chúc Mừng Hồng Phát 2",
    sale: 0,
    newPrice: "1500000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/hoa-khai-truong-trang-trong.jpg.webp",
    name: "Kệ Hoa Khai Trương Trang Trọng",
    sale: 23,
    newPrice: "1780000VND",
    oldPrice: "2320000VND",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/hoa-khai-truong-vang-danh.jpg.webp",
    name: "Hoa Khai Trương Vang Danh",
    sale: 0,
    newPrice: "1150000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/hoa-khai-truong-vung-ben.jpg.webp",
    name: "Hoa Chúc Mừng Vững Bền",
    sale: 0,
    newPrice: "1490000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/hoa-khai-truong-phon-vinh.jpg.webp",
    name: "Hoa Khai Trương - Phồn Vinh",
    sale: 0,
    newPrice: "2050000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/hoa-khai-truong-khai-hoan.jpg.webp",
    name: "Kệ Hoa Khai Trương Khải Hoàn",
    sale: 0,
    newPrice: "1850000VND",
    oldPrice: "",
  },
];

let products6 = [
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/chau-lan-ho-diep-005-02.jpg.webp",
    name: "Chậu Lan Hồ Điệp - 005",
    sale: 0,
    newPrice: "2750000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/chau-lan-ho-diep-tet-quy-phuc.jpg.webp",
    name: "Chậu Lan Hồ Điệp Tết - Phú Quý",
    sale: 0,
    newPrice: "2970000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/chau-lan-ho-diep-phat-tai-tet.jpg.webp",
    name: "Chậu Lan Hồ Điệp Tết - Phát Tài",
    sale: 0,
    newPrice: "1540000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/lan-ho-diep-06.jpg.webp",
    name: "Chậu Lan Hồ Điệp Tết - 06",
    sale: 0,
    newPrice: "2780000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/chau-lan-ho-diep-013-2.jpg.webp",
    name: "Chậu Lan Hồ Điệp - 013",
    sale: 0,
    newPrice: "2950000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202022/chau-lan-ho-diep-008-02.jpg.webp",
    name: "Chậu Lan Hồ Điệp - 008",
    sale: 0,
    newPrice: "2810000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/chau-lan-ho-diep-mini-038.jpg.webp",
    name: "Chậu Lan Hồ Điệp Mini - 038",
    sale: 0,
    newPrice: "1590000VND",
    oldPrice: "",
  },
  {
    img: "https://8384f55340.vws.vegacdn.vn/image/cache/catalog/products/August%202023/lan-ho-diep-05.jpg.webp",
    name: "Chậu Lan Hồ Điệp Tết - 05",
    sale: 0,
    newPrice: "1750000VND",
    oldPrice: "",
  },
];

// Hàm tạo HTML cho sản phẩm, bao gồm các sản phẩm có và không có giảm giá
function productsFlowerCorner(products) {
  var p = "";
  for (var i = 0; i < products.length; i++) {
    if (products[i].sale > 0 && products[i].oldPrice !== "") {
      p += `
          <div class="col-lg-3">
              <div class="card product" style="width: 18rem">
                  <a href="chi-tiet-san-pham.html" onclick="viewProductDetails('${
                    products[i].name
                  }')">
                      <img src="${products[i].img}" class="card-img-top" alt="${
        products[i].name
      }" />
                  </a>
                  <div class="icon-bar">
                      <i class="fas fa-heart"></i>
                      <i class="fas fa-plus"></i>
                      <i class="fas fa-cart-shopping"></i>
                      <i class="fas fa-sync-alt"></i>
                  </div>
                  <span class="sale">${products[i].sale}%<br />GIẢM</span>
                  <div class="card-body">
                      <h5 class="card-title text-center product-name">${
                        products[i].name
                      }</h5>
                      <p class="card-text text-center">
                          <span class="price-new">${products[i].newPrice}</span>
                          <span class="price-old">${products[i].oldPrice}</span>
                      </p>
                      <a href="#" class="btn btn-primary" onclick="addToCart('${
                        products[i].name
                      }', ${parseInt(products[i].newPrice)}, '${
        products[i].img
      }')">ĐẶT HÀNG</a>
                  </div>
              </div>
          </div>`;
    } else if (products[i].sale == 0 && products[i].oldPrice == "") {
      p += `
          <div class="col-lg-3">
              <div class="card product" style="width: 18rem">
                  <a href="chi-tiet-san-pham.html" onclick="viewProductDetails('${
                    products[i].name
                  }')">
                      <img src="${products[i].img}" class="card-img-top" alt="${
        products[i].name
      }" />
                  </a>
                  <div class="icon-bar">
                      <i class="fas fa-heart"></i>
                      <i class="fas fa-plus"></i>
                      <i class="fas fa-cart-shopping"></i>
                      <i class="fas fa-sync-alt"></i>
                  </div>
                  <div class="card-body">
                      <h5 class="card-title text-center product-name">${
                        products[i].name
                      }</h5>
                      <p class="card-text text-center">
                          <span class="price-new">${products[i].newPrice}</span>
                      </p>
                      <a href="#" class="btn btn-primary" onclick="addToCart('${
                        products[i].name
                      }', ${parseInt(products[i].newPrice)}, '${
        products[i].img
      }')">ĐẶT HÀNG</a>
                  </div>
              </div>
          </div>`;
    }
  }
  return p;
}

// Hàm tạo HTML cho sản phẩm có đếm ngược
function productsFlowerCornerCountDown(products) {
  var p = "";
  for (var i = 0; i < products.length; i++) {
    // Kiểm tra xem sản phẩm có đầy đủ thông tin cần thiết không
    if (
      !products[i].name ||
      !products[i].img ||
      !products[i].newPrice ||
      !products[i].oldPrice ||
      !products[i].sale
    ) {
      continue; // Bỏ qua sản phẩm nếu thiếu thông tin
    }

    // Tạo HTML cho từng sản phẩm
    p += `
      <div class="col-lg-3">
          <div class="card product" style="width: 18rem; position: relative;">
              <a href="chi-tiet-san-pham.html" onclick="viewProductDetails('${
                products[i].name
              }')">
                  <img src="${products[i].img}" class="card-img-top" alt="${
      products[i].name
    }" />
              </a>
              <div class="icon-bar">
                  <i class="fas fa-heart"></i>
                  <i class="fas fa-plus"></i>
                  <i class="fas fa-cart-shopping"></i>
                  <i class="fas fa-sync-alt"></i>
              </div>
              <span class="sale">${products[i].sale}%<br />GIẢM</span>
              <div class="card-body">
                  <h5 class="card-title text-center product-name">${
                    products[i].name
                  }</h5>
                  <p class="card-text text-center">
                      <span class="price-new">${products[i].newPrice}</span>
                      <span class="price-old">${products[i].oldPrice}</span>
                  </p>
                  <a href="#" class="btn btn-primary" onclick="addToCart('${
                    products[i].name
                  }', ${parseInt(products[i].newPrice)}, '${
      products[i].img
    }')">ĐẶT HÀNG</a>
              </div>
              <div class="countdown" id="countdown-${i}">
                  <div><span class="days"></span> Ngày</div>
                  <div><span class="hours"></span> Giờ</div>
                  <div><span class="minutes"></span> Phút</div>
                  <div><span class="seconds"></span> Giây</div>
              </div>
          </div>
      </div>`;
  }
  return p;
}

// Hiển thị danh sách sản phẩm từ các mảng products
document.querySelector(".list-products-1").innerHTML =
  productsFlowerCornerCountDown(products1);
document.querySelector(".list-products-2").innerHTML =
  productsFlowerCorner(products2);
document.querySelector(".list-products-3").innerHTML =
  productsFlowerCorner(products3);
document.querySelector(".list-products-4").innerHTML =
  productsFlowerCorner(products4);
document.querySelector(".list-products-5").innerHTML =
  productsFlowerCorner(products5);
document.querySelector(".list-products-6").innerHTML =
  productsFlowerCorner(products6);

// Countdown - Đếm ngược thời gian
function startCountdown(elementId, end) {
  const countdownElement = document.getElementById(elementId);

  function updateCountdown() {
    const now = new Date().getTime();
    const distance = end - now;

    if (distance < 0) {
      clearInterval(showTime);
      countdownElement.classList.add("expired");
      countdownElement.innerHTML = "Hết giờ!";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor(
      (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    );
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    countdownElement.querySelector(".days").innerText = days;
    countdownElement.querySelector(".hours").innerText = hours;
    countdownElement.querySelector(".minutes").innerText = minutes;
    countdownElement.querySelector(".seconds").innerText = seconds;
  }

  const showTime = setInterval(updateCountdown, 1000);
  updateCountdown(); // Hiển thị ngay lập tức
}

// Khởi động countdown cho từng sản phẩm trong products1
for (let i = 0; i < products1.length; i++) {
  let end = localStorage.getItem(`endTime-${i}`);

  if (!end) {
    const random = Math.floor(Math.random() * 10) + 1; // Random từ 1 đến 10 ngày
    end = new Date().getTime() + random * 24 * 60 * 60 * 1000;
    localStorage.setItem(`endTime-${i}`, end); // Lưu thời gian kết thúc vào localStorage
  }

  startCountdown(`countdown-${i}`, parseInt(end));
}

// Hàm reset lại countdown cho tất cả các sản phẩm thuộc mảng products1
function resetCountdown() {
  // Xóa các giá trị countdown cũ trong localStorage
  for (let i = 0; i < products1.length; i++) {
    localStorage.removeItem(`endTime-${i}`);
  }

  // Khởi động lại countdown với các giá trị endTime mới
  for (let i = 0; i < products1.length; i++) {
    let end = localStorage.getItem(`endTime-${i}`);

    if (!end) {
      const randomDays = Math.floor(Math.random() * 10) + 1; // Random từ 1 đến 10 ngày
      end = new Date().getTime() + randomDays * 24 * 60 * 60 * 1000;
      localStorage.setItem(`endTime-${i}`, end); // Lưu thời gian kết thúc vào localStorage
    }

    startCountdown(`countdown-${i}`, parseInt(end));
  }
}

// Hàm xử lý liên kết chi tiết sản phẩm
function viewProductDetails(productName) {
  localStorage.setItem("selectedProductName", productName);
}
